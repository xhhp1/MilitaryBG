<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>لوحة القرارات</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --btn:#2596be;
      --bg:#111;
      --card:#1c1c1c;
      --text:#f5f5f5;
      --accent:#ffd34d;
    }
    *{box-sizing:border-box;font-family:"Tahoma",Arial,sans-serif;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      padding:20px;
    }
    h1{margin-top:0;text-align:center;}
    .tabs{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-bottom:20px;
    }
    .tab-btn{
      background:var(--btn);
      border:none;
      color:#fff;
      padding:8px 14px;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      min-width:120px;
    }
    .tab-btn.active{
      box-shadow:0 0 0 2px #fff3;
      font-weight:bold;
    }
    .tab-content{
      display:none;
      padding:15px;
      background:var(--card);
      border-radius:10px;
    }
    .tab-content.active{display:block;}
    .sub-tabs{
      display:flex;
      gap:8px;
      margin-bottom:15px;
      flex-wrap:wrap;
    }
    .sub-tab-btn{
      background:var(--btn);
      border:none;
      color:#fff;
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
      font-size:13px;
    }
    .sub-tab-btn.active{
      box-shadow:0 0 0 2px #fff3;
      font-weight:bold;
    }
    .form-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:10px;
      align-items:center;
    }
    .form-row label{
      min-width:120px;
      font-size:13px;
    }
    .form-row input,
    .form-row select{
      flex:1;
      min-width:120px;
      padding:6px 8px;
      border-radius:6px;
      border:1px solid #444;
      background:#000;
      color:var(--text);
    }
    .form-row input[type="checkbox"]{
      flex:none;
      min-width:auto;
    }
    textarea{
      width:100%;
      min-height:220px;
      background:#000;
      color:var(--accent);
      padding:10px;
      border-radius:8px;
      border:1px solid #444;
      resize:vertical;
      font-size:13px;
      line-height:1.7;
      direction:rtl;
    }
    .copy-btn,.generate-btn{
      background:var(--btn);
      border:none;
      color:#fff;
      padding:7px 14px;
      border-radius:6px;
      cursor:pointer;
      font-size:13px;
      margin-top:8px;
      margin-inline-end:8px;
    }
    .note{
      font-size:12px;
      color:#ccc;
      margin-top:4px;
    }
    @media(max-width:600px){
      .form-row{flex-direction:column;align-items:stretch;}
      .form-row label{min-width:auto;}
    }
  </style>
</head>
<body>
  <h1>لوحــة القـرارات</h1>

  <!-- Main Tabs -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="tab-istiqala">استقالة</button>
    <button class="tab-btn" data-tab="tab-ijazat">اجازات</button>
    <button class="tab-btn" data-tab="tab-police">الشرطة العسكرية</button>
    <button class="tab-btn" data-tab="tab-court">مجلس القضاء</button>
  </div>

  <!-- استقالة -->
  <div id="tab-istiqala" class="tab-content active">
    <div class="sub-tabs">
      <button class="sub-tab-btn active" data-sub="ist-afrad">الأفــراد</button>
      <button class="sub-tab-btn" data-sub="ist-jundi">جندي - جندي أول - عريف</button>
      <button class="sub-tab-btn" data-sub="ist-dubbat">الضباط</button>
    </div>

    <!-- استقالة الأفراد -->
    <div id="ist-afrad" class="sub-content">
      <div class="form-row">
        <label>رقم البرقية :</label>
        <input type="number" id="afrad-barqia" placeholder="مثال 1234">
      </div>
      <div class="form-row">
        <label>الكوبي ايدي :</label>
        <input type="text" id="afrad-copyid" placeholder="@ID">
      </div>
      <div class="form-row">
        <label>اسم و كود الفرد :</label>
        <input type="text" id="afrad-namecode" placeholder="مثال حمد [CD | G-020]">
      </div>
      <textarea id="afrad-output" readonly></textarea><br>
      <button class="copy-btn" data-target="afrad-output">نسخ النص</button>
    </div>

    <!-- استقالة جندي / جندي أول / عريف -->
    <div id="ist-jundi" class="sub-content" style="display:none;">
      <div class="form-row">
        <label>رقم البرقية :</label>
        <input type="number" id="jundi-barqia" placeholder="مثال 1234">
      </div>
      <div class="form-row">
        <label>منشن العسكري :</label>
        <input type="text" id="jundi-mention" placeholder="@منشن العسكري">
      </div>
      <div class="form-row">
        <label>اسم الشخص :</label>
        <input type="text" id="jundi-name" placeholder="مثال حمد بن عسكر">
      </div>
      <div class="form-row">
        <label>كود الشخص [R-000] :</label>
        <input type="text" id="jundi-code" placeholder="مثال R-001">
      </div>
      <div class="form-row">
        <label>السبب (الرتبة) :</label>
        <select id="jundi-rank">
          <option value="جندي">جندي</option>
          <option value="جندي أول">جندي أول</option>
          <option value="عريف">عريف</option>
        </select>
      </div>
      <textarea id="jundi-output" readonly></textarea><br>
      <button class="copy-btn" data-target="jundi-output">نسخ النص</button>
    </div>

    <!-- استقالة الضباط -->
    <div id="ist-dubbat" class="sub-content" style="display:none;">
      <div class="form-row">
        <label>رقم البرقية :</label>
        <input type="number" id="dubbat-barqia" placeholder="مثال 1234">
      </div>
      <div class="form-row">
        <label>الكوبي ايدي :</label>
        <input type="text" id="dubbat-copyid" placeholder="@ID">
      </div>
      <div class="form-row">
        <label>إسم العسكري :</label>
        <input type="text" id="dubbat-name" placeholder="هنا اسمه">
      </div>
      <div class="form-row">
        <label>الكود العسكري :</label>
        <input type="text" id="dubbat-milcode" placeholder="كود الضابط هنا">
      </div>
      <div class="form-row">
        <label>الرتبة العسكرية :</label>
        <input type="text" id="dubbat-rank" placeholder="الرتب هنا">
      </div>
      <textarea id="dubbat-output" readonly></textarea><br>
      <button class="copy-btn" data-target="dubbat-output">نسخ النص</button>
    </div>
  </div>

  <!-- اجازات -->
  <div id="tab-ijazat" class="tab-content">
    <div class="sub-tabs">
      <button class="sub-tab-btn active" data-sub="ij-int">إجازة داخلية</button>
      <button class="sub-tab-btn" data-sub="ij-ext">إجازة خارجية</button>
    </div>

    <!-- إجازة داخلية -->
    <div id="ij-int" class="sub-content">
      <div class="form-row">
        <label>برقية رقم :</label>
        <input type="number" id="int-barqia" placeholder="مثال 1234">
      </div>
      <div class="form-row">
        <label>رقم الفرد :</label>
        <input type="number" id="int-person-num" placeholder="يظهر في ( 1 )">
      </div>
      <div class="form-row">
        <label>الإجازة لمن ؟</label>
        <select id="int-for">
          <option value="أفــــراد">افراد</option>
          <option value="ضباط">ضباط</option>
        </select>
      </div>
      <div class="form-row">
        <label>الكوبي ايدي (منشن العسكري) :</label>
        <input type="text" id="int-copyid" placeholder="@ID">
      </div>
      <div class="form-row">
        <label>مدة الاجازة (بالساعات) :</label>
        <input type="number" id="int-duration" placeholder="مثال 24">
      </div>
      <div class="form-row">
        <label>عدد الساعات المتبقية (قبل الإجازة) :</label>
        <input type="number" id="int-remaining-before" placeholder="رصيدك قبل الإجازة">
      </div>

      <div class="form-row">
        <label>إدخال وقت بداية الإجازة يدوياً ؟</label>
        <input type="checkbox" id="int-manual-time">
        <span class="note">في حال التفعيل استخدم الحقل أسفل</span>
      </div>
      <div class="form-row" id="int-manual-time-row" style="display:none;">
        <label>وقت بداية الإجازة (مكة) :</label>
        <input type="datetime-local" id="int-start-dt">
      </div>

      <div class="form-row">
        <label>توقيعك و اعتمادك :</label>
        <input type="text" id="int-signer" placeholder="@اسمك أو كودك">
      </div>

      <button class="generate-btn" id="int-generate">إنشاء القرار (داخلي)</button>
      <textarea id="int-output" readonly></textarea><br>
      <button class="copy-btn" data-target="int-output">نسخ النص</button>
      <div class="note">التاريخ والوقت واسم اليوم محسوبين على توقيت مكة (Asia/Riyadh).</div>
    </div>

    <!-- إجازة خارجية -->
    <div id="ij-ext" class="sub-content" style="display:none;">
      <div class="form-row">
        <label>برقية رقم :</label>
        <input type="number" id="ext-barqia" placeholder="مثال 1234">
      </div>
      <div class="form-row">
        <label>المدة (بالأيام) :</label>
        <input type="number" id="ext-days" placeholder="مثال 3">
      </div>
      <button class="generate-btn" id="ext-generate">إنشاء القرار (خارجية)</button>
      <textarea id="ext-output" readonly></textarea><br>
      <button class="copy-btn" data-target="ext-output">نسخ النص</button>
      <div class="note">تاريخ البداية وقت الضغط على زر إنشاء القرار حسب توقيت مكة، وتاريخ النهاية بعدد الأيام المدخلة.</div>
    </div>
  </div>

  <!-- الشرطة العسكرية -->
  <div id="tab-police" class="tab-content">
    <p style="text-align:center;">الشرطة العسكرية – يمكن إضافة النماذج الخاصة لاحقاً.</p>
  </div>

  <!-- مجلس القضاء -->
  <div id="tab-court" class="tab-content">
    <p style="text-align:center;">مجلس القضاء – يمكن إضافة النماذج الخاصة لاحقاً.</p>
  </div>

  <script>
    // ===== Helpers for Mecca time =====
    function addHours(date, hours){
      return new Date(date.getTime() + hours*3600000);
    }
    function addDays(date, days){
      return new Date(date.getTime() + days*86400000);
    }
    function formatMecca(date){
      const dayName = new Intl.DateTimeFormat('ar-SA',{
        timeZone:'Asia/Riyadh',
        weekday:'long'
      }).format(date);
      const dateStr = new Intl.DateTimeFormat('ar-SA',{
        timeZone:'Asia/Riyadh',
        year:'numeric',
        month:'2-digit',
        day:'2-digit'
      }).format(date).replace(/\u200f/g,'');
      const timeStr = new Intl.DateTimeFormat('ar-SA',{
        timeZone:'Asia/Riyadh',
        hour:'2-digit',
        minute:'2-digit',
        hour12:true
      }).format(date).replace(/\u200f/g,'');
      return {dayName,dateStr,timeStr};
    }

    // ===== Main tabs =====
    document.querySelectorAll('.tab-btn').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    // ===== Sub tabs (استقالة + اجازات) =====
    function setupSubTabs(containerId){
      const container = document.getElementById(containerId);
      const buttons = container.querySelectorAll('.sub-tab-btn');
      buttons.forEach(btn=>{
        btn.addEventListener('click',()=>{
          buttons.forEach(b=>b.classList.remove('active'));
          container.querySelectorAll('.sub-content').forEach(c=>c.style.display='none');
          btn.classList.add('active');
          container.querySelector('#'+btn.dataset.sub).style.display='block';
        });
      });
    }
    setupSubTabs('tab-istiqala');
    setupSubTabs('tab-ijazat');

    // ===== Copy Buttons =====
    document.querySelectorAll('.copy-btn').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const targetId = btn.dataset.target;
        const ta = document.getElementById(targetId);
        if(!ta) return;
        try{
          await navigator.clipboard.writeText(ta.value);
          const oldText = btn.textContent;
          btn.textContent = '✓ تم النسخ';
          setTimeout(()=>btn.textContent = oldText,1500);
        }catch(e){
          // لا تنبيه – فقط تجاهل
        }
      });
    });

    // ===== استقالة الأفراد =====
    function updateIstAFrad(){
      const barqia = document.getElementById('afrad-barqia').value || '0000';
      const copyId = document.getElementById('afrad-copyid').value || 'الكوبي ايدي';
      const nameCode = document.getElementById('afrad-namecode').value || 'الاسم و الكود';

      const text =
`**﷽**

\`برقيه رقم :\` ** ${barqia} **

\`الموضوع : \` ** استقالة **

**بعد ماتم مناقشته مع المسؤولين وبعد مراجعة طلب الإستقالة تم قبول استقالة المدعو :**

<@${copyId}>     \`${nameCode}\`


** شاكرين مجهوداتك الملحوظه وسائلين المولى عز وجل التوفيق في وجهتك القادمة **


\`توقيـع  :\` <@&1333955330283147285> 

\`اعـتـماد  : \`  

**مسؤول مكتب الشؤون الإداريه : <@1211838071524565023>  **


|| <@&1333955330283147285>  ||`;

      document.getElementById('afrad-output').value = text;
    }
    ['afrad-barqia','afrad-copyid','afrad-namecode'].forEach(id=>{
      document.getElementById(id).addEventListener('input',updateIstAFrad);
    });
    updateIstAFrad();

    // ===== استقالة جندي / جندي أول / عريف =====
    function updateIstJundi(){
      const barqia = document.getElementById('jundi-barqia').value || '0000';
      const mention = document.getElementById('jundi-mention').value || '@منشن العسكري';
      const name = document.getElementById('jundi-name').value || 'اسم الشخص';
      const code = document.getElementById('jundi-code').value || 'R-000';
      const rank = document.getElementById('jundi-rank').value || 'جندي';
      const days = (rank === 'عريف') ? 7 : 14;

      const text =
`** ﷽ **

\`برقيه رقم :\` **${barqia}**

\`الموضوع :\`** فصل **

\`قرار صادر من الشؤون الإدارية بحرس الحدود \`

\`بفصل العسكري:\`  ** ${mention} **  **\`[${code}] ${name} \`**

\`غرامة مليون يتم تسليمها للشؤون الإدارية و منع من التوظيف لمدة ${days} ايام\` 

\`السبب :\` ** استقاله برتبه { ${rank} }  **


\`توقيـع  :\` <@&1333955330283147285> 

\`اعـتـماد  :\` 

**مسؤول مكتب الشؤون الإداريه : <@1211838071524565023>  **

|| <@&1333955330283147285>||`;

      document.getElementById('jundi-output').value = text;
    }
    ['jundi-barqia','jundi-mention','jundi-name','jundi-code','jundi-rank']
      .forEach(id=>document.getElementById(id).addEventListener('input',updateIstJundi));
    updateIstJundi();

    // ===== استقالة الضباط =====
    function updateIstDubbat(){
      const barqia = document.getElementById('dubbat-barqia').value || '0000';
      const copyId = document.getElementById('dubbat-copyid').value || 'الكوبي ايدي';
      const name = document.getElementById('dubbat-name').value || 'هنا اسمه';
      const milcode = document.getElementById('dubbat-milcode').value || 'كود الضابط هنا';
      const rank = document.getElementById('dubbat-rank').value || 'الرتب هنا';

      const text =
`# نموذج إستقالة الضباط 

** ﷽

\`برقيه رقم :\` ${barqia}

\`الموضوع : \`  إستقالة 

بعد ماتم مناقشته مع المسؤولين وبعد مراجعة طلب الإستقالة تم قبول استقالة المدعو :

 <@${copyId}> 

 \` إسم العسكري : ${name}  \`

\` الكود العسكري : ${milcode}  \`

\` الرتبة العسكرية : ${rank}  \`

 شاكرين مجهوداتك الملحوظه وسائلين المولى عز وجل التوفيق في وجهتك القادمة 

\` توقيـع :\`

 <@&1333955330283147285>   

\` إعتماد : \`

 مسؤول مكتب الشؤون الإداريه : <@1211838071524565023>  **


** ترسل نسخه إلى الـ <@&1333955330283147285>    للإعتماد والتنفيذ **`;
      document.getElementById('dubbat-output').value = text;
    }
    ['dubbat-barqia','dubbat-copyid','dubbat-name','dubbat-milcode','dubbat-rank']
      .forEach(id=>document.getElementById(id).addEventListener('input',updateIstDubbat));
    updateIstDubbat();

    // ===== إجازة داخلية =====
    const intManualCheckbox = document.getElementById('int-manual-time');
    const intManualRow = document.getElementById('int-manual-time-row');
    intManualCheckbox.addEventListener('change',()=>{
      intManualRow.style.display = intManualCheckbox.checked ? 'flex' : 'none';
    });

    function generateInternalLeave(){
      const barqia = document.getElementById('int-barqia').value || '0000';
      const personNum = document.getElementById('int-person-num').value || '1';
      const target = document.getElementById('int-for').value || 'أفــــراد';
      const copyId = document.getElementById('int-copyid').value || 'الكوبي ايدي';
      const durationHours = parseFloat(document.getElementById('int-duration').value || '0');
      const remainingBefore = parseFloat(document.getElementById('int-remaining-before').value || '0');
      const signer = document.getElementById('int-signer').value || 'الكوبي ايدي';

      const remainingAfter = Math.max(remainingBefore - durationHours,0);

      let startDate;
      if(intManualCheckbox.checked){
        const val = document.getElementById('int-start-dt').value;
        if(val){
          startDate = new Date(val);
        }else{
          startDate = new Date();
        }
      }else{
        startDate = new Date(); // الآن
      }
      const endDate = addHours(startDate,durationHours);

      const fmtStart = formatMecca(startDate);
      const fmtEnd = formatMecca(endDate);

      const text =
`**﷽**

\`برقيه رقم :\` **${barqia}**

\`الموضوع : \`** إجازه داخليه ( ${target} ) (  ${personNum} ) **

\`منشن العسكري :  \`  ** <@${copyId}> ** 

**\`مدة الاجازة : ${durationHours} ســاعـه \` ** 

**من يوم  ${fmtStart.dayName}   | تاريخ ${fmtStart.dateStr} |  الساعة ${fmtStart.timeStr} م.ص **

** الى يوم ${fmtEnd.dayName}  | تاريخ ${fmtEnd.dateStr} | الساعة ${fmtEnd.timeStr} م.ص **

** \`عدد الساعات المتبقية : \` ${remainingAfter} ساعـــه ** 
 
**\`محرر الأجازة :  \` ** ${signer}


\`توقيـع  :\` <@&1333955330283147285> 
 
\`اعـتـماد  :\`  

** مسؤول مكتب الشؤون الإداريه : <@1211838071524565023> **

||<@&1333955330283147285> ||
||<@&1333955142164156477>||`;

      document.getElementById('int-output').value = text;
    }
    document.getElementById('int-generate').addEventListener('click',generateInternalLeave);
    // مبدئياً توليد أولي
    generateInternalLeave();

    // ===== إجازة خارجية =====
    function generateExternalLeave(){
      const barqia = document.getElementById('ext-barqia').value || '0000';
      const days = parseInt(document.getElementById('ext-days').value || '0',10);
      const now = new Date();
      const start = now;
      const end = addDays(start,Math.max(days,0));

      const fmtStart = formatMecca(start);
      const fmtEnd = formatMecca(end);

      const text =
`** ﷽**


\`برقية رقم :\`**${barqia}**

\`الموضوع  :\` ** اجازة خارجية**


\`المدة :\` ( **${days} ايام  ** ) \`من تاريخ\` **${fmtStart.dateStr}الى ${fmtEnd.dateStr}**


\`وذلك يمنع عليك التواجد في المقاطعة الا بعد كسر الاجازة خلاف ذلك تعرض نفسك للفصل\`


\`توقيع :\` <@&1333955330283147285> 

\`أعتماد :\`  <@1211838071524565023> 

|| <@&1333955330283147285>  ||`;
      document.getElementById('ext-output').value = text;
    }
    document.getElementById('ext-generate').addEventListener('click',generateExternalLeave);
    generateExternalLeave();
  </script>
</body>
</html>

